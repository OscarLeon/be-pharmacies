import { Test, TestingModule } from '@nestjs/testing';
import { PharmacyService } from './pharmacy.service';
import { AxiosResponse } from 'axios';
import { of } from 'rxjs';
import { HttpModule, HttpService } from '@nestjs/common';

describe('PharmacyService', () => {
  let service: PharmacyService;
  let httpService: HttpService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      imports: [HttpModule],
      providers: [PharmacyService],
    }).compile();

    service = module.get<PharmacyService>(PharmacyService);
    httpService = module.get<HttpService>(HttpService);
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });

  it('should return all pharmacies of RM', async () => {
    const data = [
      {
        fecha: '30-08-2020',
        local_id: '3252',
        local_nombre: 'AHUMADA',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA',
        local_direccion: '18 DE SEPTIEMBRE N° 1402',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '22:00 hrs.',
        local_telefono: '+56582231724',
        local_lat: '-18.4842849',
        local_lng: '-70.30643320000001',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '3258',
        local_nombre: 'ARICA',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA - PERIFERIA',
        local_direccion: 'SANTA MARÍA Nº 1361',
        funcionamiento_hora_apertura: '19:00 hrs.',
        funcionamiento_hora_cierre: '00:00 hrs.',
        local_telefono: '+56582310572',
        local_lat: '-18.4759322',
        local_lng: '-70.30929309999999',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '3388',
        local_nombre: 'CRUZ VERDE',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA',
        local_direccion: '21 DE MAYO N° 299',
        funcionamiento_hora_apertura: '10:30 hrs.',
        funcionamiento_hora_cierre: '22:00 hrs.',
        local_telefono: '+56582232396',
        local_lat: '-18.4782883',
        local_lng: '-70.31888600000002',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '3396',
        local_nombre: 'CRUZ VERDE',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA - PERIFERIA',
        local_direccion: '18 DE SEPTIEMBRE Nº 2501',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '22:00 hrs.',
        local_telefono: '+5658228700746',
        local_lat: '-18.490241079589318',
        local_lng: '-70.2892440902466',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '3403',
        local_nombre: 'FARMAX',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA - PERIFERIA',
        local_direccion: 'MANUEL CASTILLO IBACETA N° 3431',
        funcionamiento_hora_apertura: '09:00 hrs.',
        funcionamiento_hora_cierre: '18:00 hrs.',
        local_telefono: '+56582227495',
        local_lat: '-18.4985381',
        local_lng: '-70.2857237',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '3406',
        local_nombre: 'ISAIAS',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA - PERIFERIA',
        local_direccion: 'CANCHA RAYADA N° 4136',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '00:00 hrs.',
        local_telefono: '+56582219649',
        local_lat: '-18.438064602173476',
        local_lng: '-70.2903610467910',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '3413',
        local_nombre: 'SALCOBRAND',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA',
        local_direccion: 'COLÓN N° 598',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '22:00 hrs.',
        local_telefono: '+56582255274',
        local_lat: '-18.4772959',
        local_lng: '-70.31753830000002',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '3415',
        local_nombre: 'SALCOBRAND',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA',
        local_direccion: '21 DE MAYO N° 300',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '22:00 hrs.',
        local_telefono: '+56582253551',
        local_lat: '-18.4786164',
        local_lng: '-70.31862130000002',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '4214',
        local_nombre: 'FARMADAVILA',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA - PERIFERIA',
        local_direccion: 'SANTA MARÍA Nº 2010',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '22:00 hrs.',
        local_telefono: '+56582327617',
        local_lat: '-18.47277961534095',
        local_lng: '-70.30648067937625',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '4456',
        local_nombre: 'FARMACIAS CAPSULA FARMA',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA - PERIFERIA',
        local_direccion: 'ANIBAL PINTO N° 1514',
        funcionamiento_hora_apertura: '17:00 hrs.',
        funcionamiento_hora_cierre: '00:00 hrs.',
        local_telefono: '+560',
        local_lat: '-18.482522',
        local_lng: '-70.303580',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '5263',
        local_nombre: '24 HORAS',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA - URGENCIA',
        local_direccion: 'CHACABUCO 410',
        funcionamiento_hora_apertura: '00:00 hrs.',
        funcionamiento_hora_cierre: '23:59 hrs.',
        local_telefono: '+56954133074',
        local_lat: '-18.4770153',
        local_lng: '-70.31443819999998',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '5264',
        local_nombre: 'FARMACIA MZ',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA',
        local_direccion: 'DIEGO PORTALES 1380',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '15:00 hrs.',
        local_telefono: '+5658582223824',
        local_lat: '-18.4770788',
        local_lng: '-70.29986459999998',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '5429',
        local_nombre: 'SALCOBRAND',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA - PERIFERIA',
        local_direccion: 'DIEGO PORTALES 640 LOCALES BH 1121, 1125, 1129, 1133',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '21:00 hrs.',
        local_telefono: '+5602224223300',
        local_lat: '-18.4702559',
        local_lng: '-70.3067876',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '5479',
        local_nombre: 'CRUZ VERDE',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA - PERIFERIA',
        local_direccion: 'DIEGO PORTALES 640 LOCALES B 1065/1068/1073, ARICA',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '21:00 hrs.',
        local_telefono: '+5658232787305',
        local_lat: '-18.4702559',
        local_lng: '-70.3067876',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '5588',
        local_nombre: 'CRUZ VERDE',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA',
        local_direccion: 'DIEGO PORTALES 157, LOCAL 304',
        funcionamiento_hora_apertura: '08:30 hrs.',
        funcionamiento_hora_cierre: '22:00 hrs.',
        local_telefono: '+560',
        local_lat: '-18.4690293',
        local_lng: '-70.3079644',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '5592',
        local_nombre: 'SALCOBRAND',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA',
        local_direccion: 'DIEGO PORTALES 157, LOCALES 112, 113, 114 Y 115',
        funcionamiento_hora_apertura: '09:00 hrs.',
        funcionamiento_hora_cierre: '22:30 hrs.',
        local_telefono: '+560224223300',
        local_lat: '-18.46902421187608',
        local_lng: '-70.30794830674591',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '5731',
        local_nombre: 'MEGAPHARM',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA - PERIFERIA',
        local_direccion: 'LINDEROS PONIENTE 4711, ARICA',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '22:00 hrs.',
        local_telefono: '+560',
        local_lat: '-18.4332522',
        local_lng: '-70.28794270000003',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
      {
        fecha: '30-08-2020',
        local_id: '6015',
        local_nombre: 'MAS SALUD',
        comuna_nombre: 'ARICA',
        localidad_nombre: 'ARICA',
        local_direccion: 'LAS TORRES 2662',
        funcionamiento_hora_apertura: '10:00 hrs.',
        funcionamiento_hora_cierre: '22:00 hrs.',
        local_telefono: '+569979848365',
        local_lat: '-18.4847464',
        local_lng: '-70.2828643',
        funcionamiento_dia: 'domingo',
        fk_region: '1',
        fk_comuna: '1',
      },
    ];

    const response: AxiosResponse<any> = {
      data,
      headers: {},
      config: { url: 'http://localhost:3000/mockUrl' },
      status: 200,
      statusText: 'OK',
    };

    jest.spyOn(httpService, 'get').mockImplementationOnce(() => of(response));
    const responseAllPharmaciesByStateId = await service.getAllPharmaciesByStateId(
      '7',
    );
    expect(responseAllPharmaciesByStateId).toEqual(data);
  });
});
